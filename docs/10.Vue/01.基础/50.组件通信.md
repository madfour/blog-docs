---
title: Vue组件通信的多种方式
date: 2021-11-21 19:27:06
permalink: /vue/e33f08
categories:
  - Vue
tags:
  - Vue
---
vue组件间通信方式: `props`、`$emit`、`$ref`、`EventBus`、`$parent/$children`、`$attrs/$listeners`、`provide/inject`、`vuex`。

<!-- more -->
<div align="center">
  <img src=https://cdn.jsdelivr.net/gh/madfour/ImageStorage@master/blog/组件通信.7j7wj7ed3lg0.png width=55% />
</div>

组件之间的关系大致归类：
- 父子组件通信
- 非父子组件之间的通信（兄弟组件、隔代关系组件等）

## 1、`props` / `$emit`

### 1.1 父组件传子组件`props`

- 子组件设置`props`属性，定义接受父组件传递过来的参数。
- 父组件在使用子组件的标签中通过字面量来传递值。

```js
// Father.vue
<Children name='jack' age=20 />
// Children.vue
props:{
  name: String,
  age:{
    type: Number,   // 数据类型
    require: true,  // 是否必须传递
    defaule: 18     // 可设默认值
  }
}
```

:::details 查看示例
`Father.vue` 父组件
```vue
<template>
  <div id="app">
    <Children :users="users"></Children>
  </div>
</template>
<script>
import Children from "./components/Children"
export default {
  name: 'App',
  data(){
    return{
      users:["三儿","四儿","五儿"]
    }
  },
  components:{ Children }
}
</script>
```

`Children.vue` 子组件
```vue
<template>
  <div>
    <ul>
      <li v-for="user in users">{{user}}</li>//遍历传递过来的值，然后呈现到页面
    </ul>
  </div>
</template>
<script>
export default {
  name: 'Children',
  props:{
    users:{   // 这个就是父组件中子标签自定义名字
      type:Array, // 接受的数据类型
      required:true // 是否必须传递
    }
  }
}
</script>
```
:::


### 1.2 子组件传父组件`$emit`

- 语法：`this.$emit(eventNamem [...age])`
- 子组件通过 `$emit` 触发自定义事件(eventName)，第二个参数为传递的数据。
- 父组件绑定监听器获取子组件传递过来的参数。

```js
//  
this.$emit('add', date)

// Father.vue
<Children @add='addDate($event)'>
```

::: details 查看示例

`Children.vue` 子组件
```vue
<template>
  <div>
    <h1 @click="changeTitle">{{title}}</h1>
  </div>
</template>
<script>
export default {
  name: 'Children',
  data() {
    return {
      title:"Vue.js Demo"
    }
  },
  methods:{
    changeTitle() {
      this.$emit("titleChanged","子向父组件传值");
    }
  }
}
</script>
```

`Father.vue` 父组件
```vue
<template>
  <div id="app">
    <Children @:titleChanged="updateTitle" ></Children>
      //与子组件titleChanged自定义事件保持一致,updateTitle($event)接受传递过来的文字
    <h2>{{title}}</h2>
  </div>
</template>
<script>
import Children from "./components/Children"
export default {
  name: 'App',
  data(){
    return{
      title:"传递的是一个值"
    }
  },
  methods:{
    updateTitle(e){   //声明这个函数
      this.title = e;
    }
  },
  components:{ Children }
}
</script>
```
:::


## 2、`$refs` / `$parent`

::: tip
- 这两种都是**直接得到组件实例**，使用后可以**直接调用组件的方法或访问数据**。
- 弊端是:无法在跨级或兄弟间通信。
:::

### 2.1 `ref / $refs`
- 父组件在子组件上设置 `refName`：`<Children ref='foo'>`
- 父组件通过`$refs`获得子组件的数据：`this.$refs.[refName]`

::: details 查看示例
```js
// 子组件
export default {
  data(){
    return{
      title:"子组件 Data"
    }
  },
  methods:{
    getDate(){   //声明这个函数
      console.log('子组件 getDate')
    }
  }
}

// 父组件
<template>
  <children ref="son"></children>
</template>
<script>
  export default {
    mounted () {
      // 获取子组件的属性
      console.log(this.$refs.son.title);

      // 获取子组件的方法
      this.$refs.son.getDate()
    }
  }
</script>
```
:::


### 2.2 `$parent / $children`

::: tip
官方警示：节制使用，它们的主要目的是**作为访问组件的应急方法**。更推荐使用`props`和`events`实现父子组件通信
:::

- 访问 父/子 实例
- 



<!-- 
https://www.cnblogs.com/shaozhu520/p/10926647.html
https://www.wpgdadatong.com/cn/blog/detail?BID=B3650

兰州大学
https://manage.dec.lzu.edu.cn/student/#/StuOnlinePay
9219304886   Zjc95701
 -->